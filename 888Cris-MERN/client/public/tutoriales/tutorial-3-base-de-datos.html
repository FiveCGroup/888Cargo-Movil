<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorial 3: Base de Datos | 888Cargo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
            margin: 0;
            padding: 0;
        }
        
        .tutorial-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            min-height: 100vh;
        }
        
        .tutorial-header {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .tutorial-nav {
            background: #343a40;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-link {
            color: #adb5bd;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            background: #495057;
            color: white;
        }
        
        .tutorial-content {
            padding: 40px 60px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-header {
            background: linear-gradient(90deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 4px solid #ffc107;
            padding: 20px 30px;
            margin-bottom: 30px;
            border-radius: 8px;
        }
        
        .section h2 {
            color: #495057;
            margin: 0;
            font-size: 1.8rem;
        }
        
        .section-content {
            width: 100%;
            max-width: 100%;
        }
        
        .step {
            background: #fefefe;
            margin: 25px 20px;
            padding: 30px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            width: calc(100% - 40px);
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .step-number {
            background: #ffc107;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .step-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .tutorial-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin: 20px auto;
            display: block;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tutorial-image:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .image-caption {
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
            font-style: italic;
            margin: 10px 0 20px 0;
        }
        
        .step p {
            margin: 15px 0;
            line-height: 1.7;
        }
        
        .step ul {
            margin: 15px 0;
            padding-left: 25px;
        }
        
        .step li {
            margin-bottom: 8px;
        }
        
        @media (max-width: 768px) {
            .tutorial-content {
                padding: 20px;
            }
            .tutorial-nav {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }
        }
    </style>
</head>
<style>
/* **Nota:** He a√±adido un bloque <style> b√°sico con los estilos que deduzco de la estructura y el formato que ya proporcionaste 
    (como el uso de divs con clase 'step', 'section', 'tutorial-container', etc.) para que el c√≥digo sea completo y funcional.
    Si ya tienes un archivo CSS externo, puedes ignorar o reemplazar este bloque.
*/
body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #f4f4f9;
    margin: 0;
    padding: 0;
}
.tutorial-container {
    max-width: 1000px;
    margin: 0 auto;
    background-color: #fff;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}
.tutorial-header {
    background-color: #007bff;
    color: white;
    padding: 40px 20px;
    text-align: center;
}
.tutorial-header h1 {
    margin: 0 0 5px 0;
    font-size: 2.5em;
}
.tutorial-header h2 {
    margin: 0 0 20px 0;
    font-size: 1.5em;
    font-weight: normal;
}
.tutorial-nav {
    display: flex;
    justify-content: space-between;
    padding: 15px 20px;
    background-color: #e9ecef;
    border-bottom: 1px solid #dee2e6;
}
.nav-link {
    color: #007bff;
    text-decoration: none;
    font-weight: bold;
}
.nav-link:hover {
    text-decoration: underline;
}
.tutorial-content {
    padding: 20px;
}
.tutorial-image {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin-bottom: 10px;
    cursor: pointer;
}
.image-caption {
    text-align: center;
    font-style: italic;
    color: #6c757d;
    margin-bottom: 30px;
}
.section {
    margin-bottom: 40px;
    padding: 20px;
    border: 1px solid #dee2e6;
    border-radius: 6px;
}
.section-header {
    border-bottom: 2px solid #007bff;
    padding-bottom: 10px;
    margin-bottom: 20px;
}
.section-header h2 {
    color: #007bff;
    margin: 0;
}
.step {
    background-color: #f8f9fa;
    padding: 15px;
    border-left: 5px solid #28a745;
    margin-bottom: 15px;
    border-radius: 4px;
}
.step-title {
    font-weight: bold;
    color: #007bff;
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}
.step-number {
    background-color: #007bff;
    color: white;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    margin-right: 10px;
    font-size: 0.9em;
}
.section-content ul, .section-content ol {
    padding-left: 20px;
    margin-top: 5px;
    margin-bottom: 15px;
}
.section-content li {
    margin-bottom: 5px;
}
</style>
<body>
<div class="tutorial-container">
    <div class="tutorial-header">
        <h1>Backend</h1>
        <h2>Configuraci√≥n y Estructura</h2>
        <div style="display: flex; gap: 20px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
            <span style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px;">
                üïí 25 minutos
            </span>
            <span style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px;">
                üìä Intermedio
            </span>
            <span style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px;">
                üóÑÔ∏è SQLite
            </span>
        </div>
    </div>
    
    <div class="tutorial-nav">
        <a href="../index.html" class="nav-link">‚Üê Volver a Inicio</a>
        <a href="index.html" class="nav-link">Todos los Tutoriales</a>
        <a href="tutorial-4-backend.html" class="nav-link">Siguiente Tutorial ‚Üí</a>
    </div>
    
    <div class="tutorial-content">
        
        <!-- SECCI√ìN 1 -->
        <div class="section">
            <div class="section-header">
                <h2>üóÑÔ∏è TUTORIAL 3: Base de Datos</h2>
            </div>            
        </div>

        <!-- SECCI√ìN 2 -->
        <div class="section">
            <div class="section-header">
                <h2>üìã Introducci√≥n</h2>
            </div>
            <div class="section-content">
                <p>El sistema <strong>888Cargo</strong> utiliza <strong>SQLite</strong> como motor de base de datos principal para la administraci√≥n de informaci√≥n log√≠stica, abarcando la gesti√≥n de cargas, art√≠culos, usuarios y c√≥digos QR utilizados en el seguimiento de env√≠os.</p>

                <p>Este documento describe la estructura interna de la base de datos, sus componentes, relaciones y procesos de inicializaci√≥n, sirviendo como gu√≠a t√©cnica para desarrolladores y administradores del sistema.</p>

                <h3>üéØ Prop√≥sito del Sistema</h3>
                <p>El modelo de datos busca garantizar la trazabilidad y consistencia de la informaci√≥n durante todo el ciclo log√≠stico. Sus principales objetivos son:</p>
                <ul>
                    <li>Gestionar de forma integral las cargas y sus estados.</li>
                    <li>Controlar art√≠culos y listas de empaque asociadas a cada env√≠o.</li>
                    <li>Administrar usuarios y credenciales de manera segura.</li>
                    <li>Implementar seguimiento log√≠stico mediante c√≥digos QR √∫nicos.</li>
                    <li>Permitir la recuperaci√≥n de contrase√±as de forma segura y automatizada.</li>
                </ul>

                <h3>üß© Tecnolog√≠as Utilizadas</h3>
                <ul>
                    <li><strong>Motor de Base de Datos:</strong> SQLite 3.x</li>
                    <li><strong>Conexi√≥n:</strong> Node.js con la librer√≠a <code>sqlite3</code></li>
                    <li><strong>Ubicaci√≥n del archivo:</strong> <code>./db/packing_list.db</code></li>
                    <li><strong>Codificaci√≥n:</strong> UTF-8</li>
                    <li><strong>Modelo de Datos:</strong> Normalizado hasta 3NF</li>
                </ul>
            </div>
        </div>

        <!-- SECCI√ìN 3 -->
        <div class="section">
            <div class="section-header">
                <h2>üèóÔ∏è Arquitectura de la Base de Datos</h2>
            </div>
            <div class="image-caption">
                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.002.jpeg" alt="">
            </div>
            <div class="section-content">
                <p>El dise√±o de la base de datos se basa en la <strong>Tercera Forma Normal (3NF)</strong> para asegurar integridad, eficiencia y escalabilidad.</p>
                <ul>
                    <li><strong>Integridad referencial:</strong> uso de claves for√°neas activas.</li>
                    <li><strong>Eliminaci√≥n de redundancia:</strong> datos organizados en entidades independientes y relacionadas.</li>
                    <li><strong>Escalabilidad:</strong> √≠ndices optimizados para b√∫squedas frecuentes.</li>
                    <li><strong>Auditor√≠a:</strong> campos <code>created_at</code> y <code>updated_at</code>.</li>
                    <li><strong>Seguridad:</strong> contrase√±as cifradas con <code>bcrypt</code>.</li>
                </ul>
            </div>
        </div>

        <!-- SECCI√ìN 4 -->
        <div class="section">
            <div class="section-header">
                <h2>‚öôÔ∏è Creaci√≥n e Inicializaci√≥n</h2>
            </div>
            <div class="section-content">
                <p>El proceso de inicializaci√≥n de la base de datos se ejecuta autom√°ticamente al iniciar el servidor, mediante la funci√≥n <code>initializeDatabase()</code> ubicada en <code>backend/db.js</code>.</p>

                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.003.png" alt="">
                <p>Esta funci√≥n:</p>
                <ul>
                    <li>Conecta con el motor SQLite.</li>
                    <li>Verifica la existencia del archivo <code>packing_list.db</code>.</li>
                    <li>Crea las tablas e √≠ndices necesarios en caso de no existir.</li>
                </ul>

                <h3>Funciones principales de conexi√≥n</h3>
                <div class="step"><div class="step-title"><span class="step-number">1</span> query()</div><p>Ejecuta consultas de lectura (<code>SELECT</code>) que devuelven m√∫ltiples registros.</p></div>
                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.005.png" alt="">
                <div class="step"><div class="step-title"><span class="step-number">2</span> run()</div><p>Realiza operaciones de modificaci√≥n (<code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>).</p></div>
                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.006.png" alt="">

                <div class="step"><div class="step-title"><span class="step-number">3</span> get()</div><p>Obtiene un √∫nico registro, √∫til para validaciones espec√≠ficas.</p></div>
                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.007.png" alt="">

                <h3>Secuencia de Inicializaci√≥n</h3>
                <ol>
                    <li>Conexi√≥n al motor SQLite.</li>
                    <li>Verificaci√≥n del esquema existente.</li>
                    <li>Creaci√≥n de tablas faltantes.</li>
                    <li>Aplicaci√≥n de √≠ndices.</li>
                    <li>Confirmaci√≥n de inicializaci√≥n en logs del sistema.</li>
                </ol>
                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.004.png" alt="">
            </div>
        </div>

        <!-- SECCI√ìN 5 -->
        <div class="section">
            <div class="section-header">
                <h2>üß± Estructura de Tablas</h2>
            </div>
            <div class="section-content">
                <p>La base de datos est√° compuesta por siete tablas principales, normalizadas hasta la 3NF para asegurar integridad y rendimiento.</p>

                <h3>1Ô∏è‚É£ CLIENTE</h3>
                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.008.png" alt="">
                <ul>
                    <li><strong>Prop√≥sito:</strong> Almacenar datos de clientes (contacto, ubicaci√≥n, identificaci√≥n).</li>
                    <li><strong>Campos clave:</strong> <code>cliente_shippingMark</code>, <code>correo_cliente</code>, <code>telefono_cliente</code>.</li>
                    <li>Incluye <code>created_at</code> y <code>updated_at</code> para auditor√≠a.</li>
                </ul>

                <h3>2Ô∏è‚É£ USERS</h3>
                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.009.png" alt="">
                <ul>
                    <li>Gesti√≥n moderna de autenticaci√≥n y autorizaci√≥n.</li>
                    <li>Contrase√±as cifradas con <code>bcrypt</code>.</li>
                    <li>Campos √∫nicos: <code>username</code> y <code>email</code>.</li>
                </ul>

                <h3>3Ô∏è‚É£ CARGA</h3>
                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.010.png" alt="">
                <ul>
                    <li>Registra cada env√≠o asociado a un cliente (<code>id_cliente</code>).</li>
                    <li>Formato de c√≥digo: <code>PL-20251105-123-4567</code>.</li>
                </ul>

                <h3>4Ô∏è‚É£ ARTICULO_PACKING_LIST</h3>
                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.011.png" alt="">
                <ul>
                    <li>Detalle de productos por carga.</li>
                    <li>Campos biling√ºes y soporte de im√°genes (<code>BLOB</code>).</li>
                    <li>Campos t√©cnicos: <code>largo</code>, <code>ancho</code>, <code>alto</code>, <code>cbm</code>, <code>gw</code>.</li>
                </ul>

                <h3>5Ô∏è‚É£ CAJA</h3>
                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.012.png" alt="">
                <ul>
                    <li>Define la divisi√≥n f√≠sica de art√≠culos en cajas.</li>
                    <li>Relaci√≥n con <code>id_articulo</code>.</li>
                </ul>

                <h3>6Ô∏è‚É£ QR</h3>
                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.013.png" alt="">
                <ul>
                    <li>Gestiona los c√≥digos QR asociados a cada caja o carga.</li>
                    <li>Estados: Generado, Impreso, Escaneado.</li>
                    <li>Campos de control: <code>fecha_generacion</code>, <code>fecha_escaneado</code>, <code>contador_escaneos</code>.</li>
                </ul>

                <h3>7Ô∏è‚É£ RECOVERY_TOKENS</h3>
                <img src="images/tutorial-3-base-de-datos/Aspose.Words.16f925f6-8d20-4c5c-809d-c20ac0cf7048.014.png" alt="">      
                <ul>
                    <li>Administra tokens temporales para recuperaci√≥n de contrase√±as.</li>
                    <li>Vigencia de 30 minutos.</li>
                    <li>Eliminaci√≥n autom√°tica y relaci√≥n con <code>user_id</code>.</li>
                </ul>
            </div>
        </div>

        <!-- SECCI√ìN 6 -->
        <div class="section">
            <div class="section-header">
                <h2>üíæ Sentencias SQL del Sistema</h2>
            </div>
            <div class="section-content">
                <p>El sistema 888Cargo implementa consultas estructuradas en SQLite que cubren lectura, escritura, actualizaci√≥n, eliminaci√≥n y mantenimiento.</p>

                <h3>üîç Consultas (<code>SELECT</code>)</h3>
                <ul>
                    <li>Buscar usuario por tel√©fono.</li>
                    <li>Verificar token activo.</li>
                    <li>Listar tablas y contar registros.</li>
                </ul>

                <h3>‚ûï Inserciones (<code>INSERT</code>)</h3>
                <ul>
                    <li>Crear token de recuperaci√≥n.</li>
                    <li>Registrar usuario o carga.</li>
                </ul>

                <h3>‚úèÔ∏è Actualizaciones (<code>UPDATE</code>)</h3>
                <ul>
                    <li>Actualizar contrase√±a.</li>
                    <li>Marcar token como usado.</li>
                    <li>Invalidar tokens previos.</li>
                </ul>

                <h3>üóëÔ∏è Eliminaciones (<code>DELETE</code>)</h3>
                <ul>
                    <li>Eliminar tokens espec√≠ficos o expirados.</li>
                </ul>

                <h3>‚öôÔ∏è Mantenimiento</h3>
                <ul>
                    <li><code>PRAGMA integrity_check</code>: verificar integridad.</li>
                    <li><code>VACUUM</code>: compactar base de datos.</li>
                    <li><code>ANALYZE</code>: optimizar consultas.</li>
                </ul>
            </div>
        </div>

        <!-- SECCI√ìN 7 -->
        <div class="section">
            <div class="section-header">
                <h2>üîó Relaciones e Integridad</h2>
            </div>
            <div class="section-content">
                <p>El modelo de datos est√° dise√±ado para mantener la <strong>integridad referencial</strong> y la coherencia entre entidades, mediante el uso de:</p>
                <ul>
                    <li>Claves primarias y for√°neas correctamente definidas.</li>
                    <li>Restricciones √∫nicas en campos cr√≠ticos.</li>
                    <li>√çndices en columnas de b√∫squeda frecuente.</li>
                </ul>
            </div>
        </div>
    </div>
</div>
</body>
